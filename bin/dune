(include_subdirs unqualified)

(ocamllex lexer)

(menhir
 (modules parser))

(library
 (name basictypes)
 (modules basictypes)
 (preprocess
  (pps ppx_deriving.show)))

(library
  (name lexer)
  (libraries parser)
  (modules lexer))

(library
  (name parser)
  (libraries pirouette basictypes)
  (modules parser))

(executable
 (name main)
 (public_name main)
 (modules main)
  (preprocess
  (pps ppx_let ppx_jane))
 (libraries pirouette parser lexer controlang ocaml_backend backend_intf ocaml_interthread core_unix.command_unix core))

(executable
 (name output)
 (public_name output)
 (modules output)
 (libraries threads.posix stdune))

(library
 (name pirouette)
 (modules pirouette)
 (libraries basictypes)
 (preprocess
  (pps ppx_deriving.show)))

(library
 (name controlang)
 (modules controlang)
 (libraries basictypes pirouette)
 (preprocess
  (pps ppx_deriving.show)))

(library
 (name constants)
 (modules constants))

(library
 (name backend_intf)
 (modules backend_intf)
 (libraries controlang))

 (library
 (name ocaml_interthread)
 (modules ocaml_interthread)
 (libraries backend_intf constants))

(library
 (name ocaml_backend)
 (modules ocaml_backend)
 (libraries backend_intf constants controlang basictypes ocaml_interthread))

